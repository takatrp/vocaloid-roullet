<!DOCTYPE html>
<html lang="ja">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Yomogi&family=Yusei+Magic&display=swap" rel="stylesheet">
<title>ã¿ãƒ¼ã“ã®ãŸã‚ã®ãƒœã‚«ãƒ­ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</title>
<style>
  :root{
    --bg: linear-gradient(180deg,#fff8fc 0%, #f0f9ff 100%);
    --panel:#ffffff; --muted:#6b7280; --text:#1f2937; 
    --accent:#ff66b3; --accent-2:#60a5fa; --accent-3:#10b981; --danger:#ef4444; --border:#ffd3ea;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);}  
  header{position:sticky;top:0;z-index:10;background:var(--panel);padding:12px;border-bottom:2px solid var(--border);text-align:center}
  h1{font-family:'Mochiy Pop One','Yusei Magic','Yomogi','Yu Gothic','Hiragino Kaku Gothic ProN','Meiryo',system-ui,sans-serif;font-size:20px;margin:0;letter-spacing:.3px;text-shadow:0 1px 0 #ffd3ea;}
  .wrap{padding:12px; max-width:420px; margin:0 auto;}
  .panel{background:var(--panel);border:2px solid var(--border);border-radius:16px;padding:12px;margin-bottom:12px;box-shadow:0 6px 20px rgba(255,102,179,.08)}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
  input,select,button{width:100%;padding:12px;border-radius:12px;border:1px solid #e5e7eb;background:#ffffff;color:var(--text);font-size:14px}
  select[multiple]{min-height:96px}
  button{cursor:pointer;margin-top:8px}
  button.btn-primary{background:var(--accent);color:white;font-weight:700;border:1px solid #ff4da6;box-shadow:0 4px 10px rgba(255,102,179,.25)}
  button.btn-primary:active{transform:translateY(1px)}
  .chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
  .chip{border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;background:#fff0f7}
  canvas{width:100%;max-width:320px;height:auto;display:block;margin:0 auto;background:#ffffff;border-radius:16px;border:2px dashed var(--border)}
  .result{font-size:18px;font-weight:800;margin-top:10px;text-align:center}
  .pill{display:inline-block;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;margin:2px;background:#fef3ff}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  details>summary{cursor:pointer;list-style:none}
  details>summary::-webkit-details-marker{display:none}
  .test-pass{color:#16a34a}
  .test-fail{color:#dc2626}
@media (max-width: 360px){ h1{ font-size:18px; } }
</style>
</head>
<body>
<header><h1>ğŸ° ã¿ãƒ¼ã“ã®ãŸã‚ã®ãƒœã‚«ãƒ­ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h1></header>
<div class="wrap">
  <div class="panel">
    <label>å¹´ä»£ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆä¾‹: 2020ã€œ2025ï¼‰</label>
    <div class="row">
      <input id="minYear" type="number" placeholder="æœ€å°å¹´" />
      <input id="maxYear" type="number" placeholder="æœ€å¤§å¹´" />
    </div>
    <label style="margin-top:6px">ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
    <select id="producerFilter" multiple></select>
    <label style="margin-top:6px">æ¤œç´¢ï¼ˆæ›²å/ãƒœã‚«ãƒ­ï¼‰</label>
    <input id="q" type="text" placeholder="ä¾‹: åˆéŸ³ãƒŸã‚¯ / DECO*27 / Kanaria" />
    <button class="btn-primary" id="applyBtn">ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨</button>
    <div class="chips" id="activeChips"></div>
  </div>

  <div class="panel" style="text-align:center">
    <canvas id="wheel" width="320" height="320" aria-label="ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ"></canvas>
    <button class="btn-primary" id="spinBtn">å›ã™</button>
    <div class="result" id="resultTitle">â€”</div>
    <div id="resultMeta"></div>
    <div style="margin-top:8px;display:grid;grid-template-columns:1fr 1fr;gap:8px;max-width:320px;margin-inline:auto">
      <button id="ytBtn" class="btn-primary" style="background:var(--accent-2);border-color:#3b82f6;box-shadow:0 4px 10px rgba(59,130,246,.18)">YouTubeæ¤œç´¢</button>
      <button id="nicoBtn" class="btn-primary" style="background:var(--accent-3);border-color:#10b981;box-shadow:0 4px 10px rgba(16,185,129,.18)">ãƒ‹ã‚³å‹•æ¤œç´¢</button>
    </div>
    <p style="color:var(--muted);font-size:12px;margin-top:8px">æ³¨ï¼šå¹´ã¯ä»£è¡¨çš„ãªå…¬é–‹å¹´ã‚’è¨˜è¼‰ã€‚å³å¯†ãªåˆå‡ºå¹´ã¯å…¬å¼å‹•ç”»ç­‰ã§ã”ç¢ºèªãã ã•ã„ã€‚</p>
  </div>

  <details class="panel">
    <summary><strong>ğŸ§ª å†…è”µã‚»ãƒ«ãƒ•ãƒ†ã‚¹ãƒˆ</strong>ï¼ˆã‚¿ãƒƒãƒ—ã§è¡¨ç¤ºï¼‰</summary>
    <div id="testOutput" style="font-size:13px;line-height:1.6;margin-top:6px"></div>
  </details>
</div>

<script>
'use strict';
// ===================== å…ˆã«å®šæ•°ã‚’å®šç¾©ï¼ˆTAU ã‚’å…ˆé ­ã§å®šç¾©ï¼‰ =====================
const TAU = Math.PI * 2; // â† draw()/spin() ã‚ˆã‚Šå‰ã«ã‚ã‚‹ã“ã¨ãŒé‡è¦

// ====== ã‚µãƒ³ãƒ—ãƒ«æ›²ãƒ‡ãƒ¼ã‚¿ï¼ˆ50æ›²ã€2020å¹´ä»¥é™ã‚’å¢—é‡ï¼‰ ======
const defaultSongs = [
  // --- 2020 ä»¥é™ ---
  {title:'KING', producer:'Kanaria', year:2020, vocaloid:['GUMI']},
  {title:'ã‚°ãƒƒãƒã‚¤å®£è¨€', producer:'Chinozo', year:2020, vocaloid:['flower']},
  {title:'ã‚¢ãƒ‹ãƒãƒ«', producer:'DECO*27', year:2020, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'é™ã‚Šãªãç°è‰²ã¸', producer:'ã™ã‚Šãƒ', year:2020, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ‹ãƒ“ãƒ§ã‚¦ã‚«ãƒ³', producer:'ã‹ã„ã‚Šããƒ™ã‚¢', year:2020, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'æ„›è¨€è‘‰â…£', producer:'DECO*27', year:2020, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ•ã‚©ãƒ‹ã‚¤', producer:'ãƒ„ãƒŸã‚­', year:2021, vocaloid:['å¯ä¸ (KAFU)']},
  {title:'ç¥ã£ã½ã„ãª', producer:'ãƒ”ãƒã‚­ã‚ªãƒ”ãƒ¼', year:2021, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ´ã‚¡ãƒ³ãƒ‘ã‚¤ã‚¢', producer:'DECO*27', year:2021, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ã‚·ãƒ³ãƒ‡ãƒ¬ãƒ©', producer:'DECO*27', year:2021, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'QUEEN', producer:'Kanaria', year:2021, vocaloid:['GUMI']},
  {title:'EYE', producer:'Kanaria', year:2021, vocaloid:['GUMI']},
  {title:'ã‚¨ã‚´ãƒ­ãƒƒã‚¯', producer:'ã™ã‚Šãƒ', year:2021, vocaloid:['å¯ä¸ (KAFU)']},
  {title:'ãƒˆãƒ³ãƒ‡ãƒ¢ãƒ¯ãƒ³ãƒ€ãƒ¼ã‚º', producer:'sasakure.UK', year:2021, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ€ãƒ¼ãƒªãƒ³ãƒ€ãƒ³ã‚¹', producer:'ã‹ã„ã‚Šããƒ™ã‚¢', year:2021, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ã‚¨ãƒ³ãƒ´ã‚£ãƒ¼ãƒ™ã‚¤ãƒ“ãƒ¼', producer:'Kanaria', year:2021, vocaloid:['flower']},
  {title:'é…”ã„ã©ã‚ŒçŸ¥ã‚‰ãš', producer:'Kanaria', year:2022, vocaloid:['GUMI']},
  {title:'ãƒãƒ¼ã‚·ãƒ£ãƒ«ãƒ»ãƒã‚­ã‚·ãƒã‚¤ã‚¶ãƒ¼', producer:'æŸŠãƒã‚°ãƒã‚¿ã‚¤ãƒˆ', year:2022, vocaloid:['å¯ä¸ (KAFU)']},
  {title:'å¼·é¢¨ã‚ªãƒ¼ãƒ«ãƒãƒƒã‚¯', producer:'ã‚†ã“ã´', year:2022, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒã‚°', producer:'ã‹ã„ã‚Šããƒ™ã‚¢', year:2022, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ©ãƒ“ãƒƒãƒˆãƒ›ãƒ¼ãƒ«', producer:'DECO*27', year:2023, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ©ãƒ´ã‚£', producer:'ã™ã‚Šãƒ', year:2023, vocaloid:['å¯ä¸ (KAFU)']},
  {title:'ç¾¤é’è®ƒæ­Œ', producer:'DECO*27', year:2021, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãŸã å£°ä¸€ã¤', producer:'ã„ã‚ˆã‚', year:2020, vocaloid:['å¯ä¸ (KAFU)']},
  {title:'ãã‚…ã†ãã‚‰ã‚Šã‚“', producer:'ã„ã‚ˆã‚', year:2021, vocaloid:['å¯ä¸ (KAFU)']},

  // --- å®šç•ªï¼ˆè£œå®Œï¼‰ ---
  {title:'ã‚´ãƒ¼ã‚¹ãƒˆãƒ«ãƒ¼ãƒ«', producer:'DECO*27', year:2016, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ä¹™å¥³è§£å‰–', producer:'DECO*27', year:2019, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ’ãƒãƒŠ', producer:'DECO*27', year:2017, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'å¦„æƒ³æ„Ÿå‚·ä»£å„Ÿé€£ç›Ÿ', producer:'DECO*27', year:2016, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ™ãƒãƒ ', producer:'ã‹ã„ã‚Šããƒ™ã‚¢', year:2018, vocaloid:['flower']},
  {title:'åŠ£ç­‰ä¸Šç­‰', producer:'Giga & Reol', year:2018, vocaloid:['é¡éŸ³ãƒªãƒ³','é¡éŸ³ãƒ¬ãƒ³']},
  {title:'ãƒ’ãƒ“ã‚«ã‚»', producer:'Giga', year:2014, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ã‚¸ãƒ£ãƒ³ã‚­ãƒ¼ãƒŠã‚¤ãƒˆã‚¿ã‚¦ãƒ³ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ©', producer:'ã™ã‚Šãƒ', year:2019, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ†ãƒ¬ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼ãƒ“ãƒ¼ãƒœãƒ¼ã‚¤', producer:'ã™ã‚Šãƒ', year:2018, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ç ‚ã®æƒ‘æ˜Ÿ', producer:'ãƒãƒ', year:2017, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒãƒˆãƒªãƒ§ã‚·ã‚«', producer:'ãƒãƒ', year:2010, vocaloid:['åˆéŸ³ãƒŸã‚¯','GUMI']},
  {title:'åƒæœ¬æ¡œ', producer:'é»’ã†ã•P', year:2011, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ã‹ã‚‰ãã‚Šãƒ”ã‚¨ãƒ­', producer:'40mP', year:2011, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'æ‹æ„›è£åˆ¤', producer:'40mP', year:2014, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ¡ãƒ©ãƒ³ã‚³ãƒªãƒƒã‚¯', producer:'Junky', year:2011, vocaloid:['é¡éŸ³ãƒªãƒ³']},
  {title:'ãƒ­ã‚¹ãƒˆãƒ¯ãƒ³ã®å·å“­', producer:'Neru', year:2013, vocaloid:['é¡éŸ³ãƒªãƒ³']},
  {title:'Tell Your World', producer:'kz (livetune)', year:2012, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'Calc.', producer:'ã‚¸ãƒŸãƒ¼ã‚µãƒ P', year:2010, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'å¤©ãƒå¼±', producer:'164', year:2011, vocaloid:['GUMI']},
  {title:'ãƒãƒƒãƒ”ãƒ¼ã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶', producer:'EasyPop', year:2010, vocaloid:['GUMI','å·¡éŸ³ãƒ«ã‚«']},
  {title:'ãƒ«ã‚«ãƒ«ã‚«â˜…ãƒŠã‚¤ãƒˆãƒ•ã‚£ãƒ¼ãƒãƒ¼', producer:'samfree', year:2010, vocaloid:['å·¡éŸ³ãƒ«ã‚«']},
  {title:'ãƒ¡ãƒ«ãƒˆ', producer:'ryo (supercell)', year:2007, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚¤ã‚ºãƒã‚¤ãƒ³', producer:'ryo (supercell)', year:2008, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'ãƒ­ãƒŸã‚ªã¨ã‚·ãƒ³ãƒ‡ãƒ¬ãƒ©', producer:'doriko', year:2009, vocaloid:['åˆéŸ³ãƒŸã‚¯']},
  {title:'Just Be Friends', producer:'Dixie Flatline', year:2009, vocaloid:['å·¡éŸ³ãƒ«ã‚«']}
];

let songs = [...defaultSongs];
let filtered = [...songs];
let lastPick = null;
let spinning = false; // é€£æ‰“ã‚¬ãƒ¼ãƒ‰
let angle = 0;        // ç¾åœ¨è§’

const els = {
  minYear: document.getElementById('minYear'),
  maxYear: document.getElementById('maxYear'),
  producerFilter: document.getElementById('producerFilter'),
  q: document.getElementById('q'),
  applyBtn: document.getElementById('applyBtn'),
  wheel: document.getElementById('wheel'),
  spinBtn: document.getElementById('spinBtn'),
  resultTitle: document.getElementById('resultTitle'),
  resultMeta: document.getElementById('resultMeta'),
  ytBtn: document.getElementById('ytBtn'),
  nicoBtn: document.getElementById('nicoBtn'),
  chips: document.getElementById('activeChips'),
  testOut: document.getElementById('testOutput'),
};

// ===================== åˆæœŸåŒ– =====================
(function init(){
  els.minYear.value = 2020;
  els.maxYear.value = new Date().getFullYear();
  renderProducerOptions();
  applyFilters();
  runTests(); // ã‚»ãƒ«ãƒ•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
})();

// ===================== ã‚¤ãƒ™ãƒ³ãƒˆ =====================
els.applyBtn.addEventListener('click', ()=>{ if(!spinning){ applyFilters(); angle = 0; draw(); } });
els.spinBtn.addEventListener('click', spin);
els.ytBtn.addEventListener('click', ()=>openSearch('yt'));
els.nicoBtn.addEventListener('click', ()=>openSearch('nico'));

function renderProducerOptions(){
  const set = new Set(songs.map(s=>s.producer));
  els.producerFilter.innerHTML = '';
  Array.from(set).sort((a,b)=>a.localeCompare(b,'ja')).forEach(p=>{
    const opt = document.createElement('option');
    opt.value=p; opt.textContent=p; els.producerFilter.appendChild(opt);
  });
}

function applyFilters(){
  const minY = parseInt(els.minYear.value)||0;
  const maxY = parseInt(els.maxYear.value)||9999;
  const qs = (els.q.value||'').trim().toLowerCase();
  const pros = Array.from(els.producerFilter.selectedOptions).map(o=>o.value);

  filtered = songs.filter(s=>{
    const byYear = !s.year || (s.year>=minY && s.year<=maxY);
    const byP = pros.length===0 || pros.includes(s.producer);
    const byQ = !qs || s.title.toLowerCase().includes(qs) || s.producer.toLowerCase().includes(qs) || (s.vocaloid||[]).some(v=>v.toLowerCase().includes(qs));
    return byYear && byP && byQ;
  });
  renderChips({minY,maxY,pros,qs});
  draw();
}

function renderChips({minY,maxY,pros,qs}){
  els.chips.innerHTML = '';
  const add = (t)=>{const s=document.createElement('span');s.className='chip';s.textContent=t;els.chips.appendChild(s)}
  add(`å€™è£œ: ${filtered.length}æ›²`);
  add(`å¹´: ${minY}ã€œ${maxY}`);
  if(pros.length) add(`P: ${pros.join(' / ')}`);
  if(qs) add(`æ¤œç´¢: ${qs}`);
}

// ===================== ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæç”» =====================
function draw(){
  const c=els.wheel; const ctx=c.getContext('2d');
  const N=filtered.length;
  ctx.clearRect(0,0,c.width,c.height);
  if(N===0){ctx.fillStyle='#9aa4b2';ctx.textAlign='center';ctx.font='14px system-ui';ctx.fillText('å€™è£œãªã—',c.width/2,c.height/2);return;}
  const cx=c.width/2,cy=c.height/2,r=Math.min(c.width,c.height)*0.45;
  const step=TAU/N;
  for(let i=0;i<N;i++){
    const start=angle+i*step,end=start+step;
    ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,start,end);ctx.closePath();
    // ã‚«ãƒ©ãƒ•ãƒ«ã§ãƒãƒƒãƒ—ãªé…è‰²ï¼ˆå½©åº¦ã¨æ˜åº¦ã‚’é«˜ã‚ã«ï¼‰
    ctx.fillStyle=`hsl(${(i*360/N)|0} 85% ${i%2?60:50}%)`;
    ctx.fill();
    ctx.strokeStyle='rgba(0,0,0,.06)';ctx.lineWidth=2;ctx.stroke();
    ctx.save();ctx.translate(cx,cy);ctx.rotate((start+end)/2);
    ctx.textAlign='right';ctx.textBaseline='middle';ctx.fillStyle='#ffffff';ctx.font='12px system-ui';
    const label = filtered[i].title.length>14? filtered[i].title.slice(0,13)+'â€¦' : filtered[i].title;
    ctx.fillText(label,r-6,0);
    ctx.restore();
  }
  // pointerï¼ˆãƒãƒƒãƒ—ã‚«ãƒ©ãƒ¼ï¼‰
  ctx.beginPath();ctx.moveTo(cx,cy-r-2);ctx.lineTo(cx-12,cy-r+20);ctx.lineTo(cx+12,cy-r+20);ctx.closePath();ctx.fillStyle='#ff3d8b';ctx.fill();
}

function norm(a){ a%=TAU; if(a<0) a+=TAU; return a; }

// ===================== ã‚¹ãƒ”ãƒ³ =====================
function spin(){
  if(spinning) return;
  if(filtered.length===0){ alert('å€™è£œãŒã‚ã‚Šã¾ã›ã‚“'); return; }
  spinning = true; els.spinBtn.disabled = true;

  const N=filtered.length; const step=TAU/N;
  const target = Math.floor(Math.random()*N);
  const targetAngleAtTop = (Math.PI*1.5) - (target*step + step/2); // ä¸Šç«¯ã§åœæ­¢

  const curr = norm(angle);
  const delta = norm(targetAngleAtTop - curr); // 0..TAU
  const extraTurns = 6; // 6å›è»¢ä»¥ä¸Š
  const startAngle = angle;
  const finalAngle = startAngle + delta + extraTurns*TAU;

  const start = performance.now();
  const dur = 3000; // 3s
  (function tick(now){
    const t = Math.min(1,(now-start)/dur);
    const eased = 1 - Math.pow(1-t,3); // easeOutCubic
    angle = startAngle + (finalAngle - startAngle) * eased;
    draw();
    if(t<1){ requestAnimationFrame(tick); }
    else{ spinning=false; els.spinBtn.disabled = false; showResult(filtered[target]); }
  })(performance.now());
}

function showResult(song){
  lastPick=song;
  els.resultTitle.textContent=song.title;
  els.resultMeta.innerHTML=`<span class="pill">${song.producer}</span> ${song.year?`<span class="pill">${song.year}å¹´</span>`:''} ${(song.vocaloid||[]).length?`<span class=\"pill\">${song.vocaloid.join(' / ')}</span>`:''}`;
}

function openSearch(kind){
  if(!lastPick){alert('å…ˆã«å›ã—ã¦ãã ã•ã„');return;}
  const q=`${lastPick.title} ${lastPick.producer} VOCALOID`;
  const url=kind==='yt'?`https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`:`https://www.nicovideo.jp/search/${encodeURIComponent(q)}`;
  window.open(url,'_blank');
}

// ===================== ğŸ§ª ã‚»ãƒ«ãƒ•ãƒ†ã‚¹ãƒˆ =====================
function runTests(){
  const out = els.testOut; const results = [];
  const pass = (name)=>results.push(`<div class="test-pass">âœ” ${name}</div>`);
  const fail = (name,err)=>results.push(`<div class="test-fail">âœ– ${name} â€” ${err}</div>`);

  // Test 1: TAU å®šç¾©ãƒ»å€¤
  try { if (typeof TAU==='number' && TAU>6 && TAU<7) pass('TAU å®šç¾©ãƒ»å€¤ãŒæ­£ã—ã„'); else fail('TAU å®šç¾©', `TAU=${TAU}`);} catch(e){ fail('TAU å®šç¾©', e.message); }

  // Test 2: åˆæœŸæç”»
  try { draw(); pass('draw() åˆæœŸæç”»ã«æˆåŠŸ'); } catch(e){ fail('draw() åˆæœŸæç”»', e.message); }

  // Test 3: å¹´ä»£ãƒ•ã‚£ãƒ«ã‚¿å°†æ¥å¹´â†’0ä»¶
  try { const b1=els.minYear.value, b2=els.maxYear.value; els.minYear.value=2050; els.maxYear.value=2051; applyFilters();
        if(filtered.length===0) pass('å¹´ä»£ãƒ•ã‚£ãƒ«ã‚¿: å°†æ¥å¹´ã§ 0 ä»¶'); else fail('å¹´ä»£ãƒ•ã‚£ãƒ«ã‚¿', `å®Ÿéš›:${filtered.length}`);
        els.minYear.value=b1; els.maxYear.value=b2; applyFilters(); } catch(e){ fail('å¹´ä»£ãƒ•ã‚£ãƒ«ã‚¿', e.message); }

  // Test 4: è§’åº¦è¨ˆç®—ãŒæœ‰é™
  try { const N=Math.max(1,filtered.length); const step=TAU/N; const t=Math.floor(Math.random()*N); const a=(Math.PI*1.5)-(t*step+step/2); if(Number.isFinite(a)) pass('è§’åº¦è¨ˆç®—=æœ‰é™'); else fail('è§’åº¦è¨ˆç®—','NaN/Inf'); } catch(e){ fail('è§’åº¦è¨ˆç®—', e.message); }

  out.innerHTML = results.join('');
}
</script>
</body>
</html>
